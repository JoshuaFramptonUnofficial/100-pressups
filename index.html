<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>100 Pressup Fundraiser</title>
  <meta name="description" content="Joshua's 100 press-ups a day in September. Watch daily videos and donate to Cancer Research UK." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1223;         /* deep navy */
      --panel:#171a34;      /* card */
      --ink:#e8ebff;        /* text */
      --muted:#9aa3c7;      /* secondary text */
      --brand:#7c3aed;      /* purple */
      --brand-2:#22d3ee;    /* cyan */
      --accent:#10b981;     /* green */
      --danger:#ef4444;     /* red */
      --shadow: 0 15px 40px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--ink); background:
        radial-gradient(1200px 600px at 10% -10%, rgba(124,58,237,.25), transparent 60%),
        radial-gradient(800px 400px at 100% 0%, rgba(34,211,238,.25), transparent 50%),
        var(--bg);
      overflow-x:hidden;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    .container{max-width:1100px; margin:0 auto; padding:24px}

    header{display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap}
    .brand{display:flex; gap:14px; align-items:center}
    .logo{width:42px; height:42px; display:grid; place-items:center; border-radius:12px; background:linear-gradient(135deg, var(--brand), var(--brand-2)); box-shadow:var(--shadow);}    
    .title h1{margin:0;font-size:clamp(20px,2.4vw,34px)}
    .title p{margin:4px 0 0;color:var(--muted);font-weight:600}

    .cta-row{display:flex; gap:12px; align-items:center}
    .btn{appearance:none;border:none;cursor:pointer;font-weight:800;padding:10px 14px;border-radius:12px;display:inline-flex;align-items:center;gap:8px}
    .btn.primary{background:linear-gradient(135deg,var(--brand),var(--brand-2)); color:white}
    .btn.ghost{background:transparent;color:var(--ink);border:1px solid rgba(255,255,255,.08)}

    main{display:grid; grid-template-columns:1.15fr .85fr; gap:20px; margin-top:18px}
    @media (max-width:980px){main{grid-template-columns:1fr}}

    .panel{background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08); border-radius:18px; box-shadow:var(--shadow)}
    .calendar{padding:18px}
    .cal-header{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:12px}
    .legend{display:flex; gap:10px; align-items:center; color:var(--muted)}

    /* Calendar grid */
    .grid{display:grid; gap:10px; grid-template-columns:repeat(7,1fr)}
    .dow{color:var(--muted); font-weight:700; text-align:center}

    .day{position:relative; min-height:88px; padding:10px; border-radius:12px; overflow:hidden; cursor:pointer; background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)); border:1px solid rgba(255,255,255,.06); transition:transform .12s ease, border-color .12s ease}
    .day:hover{transform:translateY(-3px); border-color:rgba(255,255,255,.18)}
    .day.is-empty{opacity:.45}
    .num{font-weight:800; font-size:16px}
    .badge{position:absolute; right:8px; top:8px; font-size:12px; padding:4px 8px; border-radius:999px; background:rgba(16,185,129,.15); color:#d1fae5; border:1px solid rgba(16,185,129,.35)}
    .badge.miss{background:rgba(239,68,68,.12); color:#fecaca; border-color:rgba(239,68,68,.3)}

    /* Player side */
    .player{padding:16px}
    .player-card{padding:14px; border-radius:14px; background:linear-gradient(135deg, rgba(124,58,237,.06), rgba(34,211,238,.04)); border:1px solid rgba(255,255,255,.06)}

    /* The frame contains the video/placeholder and the shimmer overlay.  */
    /* Square player: 1:1 aspect ratio */
    .frame{position:relative; aspect-ratio:1/1; width:100%; border-radius:12px; background:#050615; overflow:hidden}

    /* Shimmer overlay applied to the frame only, so it stays inside the video box */
    .frame.shimmer::after{
      content:""; position:absolute; inset:0; pointer-events:none; border-radius:12px;
      background:linear-gradient(120deg, transparent 15%, rgba(255,255,255,.06) 35%, transparent 55%);
      transform:translateX(-160%); animation:shine 2s linear infinite;
    }
    @keyframes shine{to{transform:translateX(160%)}}

    /* simple placeholder text inside the player before a video is loaded */
    .placeholder{display:grid; place-items:center; height:100%; color:var(--muted); font-weight:700}

    .meta{display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:12px}
    .meta small{color:var(--muted)}

    footer{margin:28px 0 8px; color:var(--muted); text-align:center}

    /* Accessibility focus styles */
    .day:focus{outline:3px solid rgba(124,58,237,.25); outline-offset:3px}

    /* small screens: make calendar more breathable */
    @media (max-width:520px){ .grid{gap:8px} .day{min-height:72px} }

    /* iframe fill helper */
    .player-iframe{position:absolute; inset:0; width:100%; height:100%; border:0; display:block}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg width="26" height="26" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M7 3c2.5-1.2 5.5 1.2 5 3.8C14 4 17 2 19 5c1.2 1.7.8 4.2-.8 5.6L12 16l-6.2-5.4C4 9 3.6 6.6 4.8 5 5.5 4 6.4 3.4 7 3Z" fill="white" fill-opacity=".95"/>
          </svg>
        </div>
        <div class="title">
          <h1>100 Press-Ups a Day Fundraiser</h1>
          <p>Watch the daily video & support <strong>Cancer Research UK</strong>.</p>
        </div>
      </div>

      <div class="cta-row">
        <a class="btn primary" target="_blank" rel="noopener" href="https://fundraise.cancerresearchuk.org/donate/06482e6c-ac34-486c-88b0-5bf586f30cf8/details" title="Donate to Cancer Research UK">Donate</a>
        <button class="btn ghost" id="latestBtn" title="Jump to the latest uploaded video">Watch Latest</button>
      </div>
    </header>

    <main>
      <!-- Calendar (September only) -->
      <section class="panel calendar" aria-label="Calendar">
        <div class="cal-header">
          <div>
            <!-- month label remains static for this site (September only) -->
            <h2 id="monthLabel">September 2025</h2>
            <div class="legend"><span class="dot" style="background:rgba(16,185,129,.9);width:10px;height:10px;border-radius:999px;display:inline-block;margin-right:8px"></span> Video added <span style="margin-left:14px;display:inline-block;width:10px;height:10px;border-radius:999px;background:rgba(239,68,68,.8);margin-right:8px"></span> No video yet</div>
          </div>
        </div>

        <!-- day-of-week header -->
        <div class="grid" id="dowRow" aria-hidden="true"></div>
        <!-- days will be populated here -->
        <div class="grid" id="daysGrid" role="grid" aria-label="September days"></div>
      </section>

      <!-- Player Panel -->
      <section class="panel player" aria-label="Video player">
        <div class="player-card">
          <!-- Frame contains the actual player or a placeholder. Shimmer is applied to this frame specifically. -->
          <div id="playerFrame" class="frame shimmer" role="region" aria-label="Video player">
            <div id="playerMount" class="player-content" aria-live="polite">
              <!-- initial placeholder (will be replaced when a video is selected) -->
              <div class="placeholder">Select a date to watch the video</div>
            </div>
          </div>

          <div class="meta">
            <div>
              <strong id="selectedDateLabel">No date selected</strong>
              <div><small id="statusLabel">Click a day on the calendar to play the video.</small></div>
            </div>
            <div style="display:flex; gap:8px; align-items:center">
              <a class="btn primary" target="_blank" rel="noopener" href="https://fundraise.cancerresearchuk.org/donate/06482e6c-ac34-486c-88b0-5bf586f30cf8/details">Donate Now</a>
              <!-- Open on YouTube fallback; hidden until a video is loaded -->
              <a id="openOnYouTube" class="btn ghost" target="_blank" rel="noopener" href="#" style="display:none">Open on YouTube</a>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <p>Built by Joshua for the September 100 press-ups challenge. Thank you for supporting life-saving research.</p>
    </footer>
  </div>

  <script>
    /* =========================
       Configuration: edit this object only
       Keys must be exact ISO dates (YYYY-MM-DD). Only September entries are relevant.

       To add a new video, add a single line like:
         '2025-09-02': 'https://youtube.com/shorts/VIDEO_ID',
       Supported URL forms:
         - https://youtube.com/watch?v=VIDEO_ID
         - https://youtu.be/VIDEO_ID
         - https://youtube.com/shorts/VIDEO_ID
         - https://www.youtube.com/embed/VIDEO_ID
       The script will extract the VIDEO_ID and create an iframe that fills the square player.

       NOTE: values should be plain strings (URLs). Avoid pasting entire iframe HTML — the script handles URLs cleanly.
       ========================= */

    const videosByDate = {
      // Day 1 (you supplied this link)
      '2025-09-01': 'https://youtube.com/shorts/2EaHb57-M04?feature=share'
      '2025-09-02': 'https://youtube.com/shorts/6wCqKku0kuU?feature=share'
      // add more days here in the same format
    };

    /* -------------------------
       Cached DOM references
       ------------------------- */
    const monthLabel = document.getElementById('monthLabel');
    const dowRow = document.getElementById('dowRow');
    const daysGrid = document.getElementById('daysGrid');
    const playerFrame = document.getElementById('playerFrame'); // contains shimmer overlay
    const playerMount = document.getElementById('playerMount'); // content inside the frame
    const selectedDateLabel = document.getElementById('selectedDateLabel');
    const statusLabel = document.getElementById('statusLabel');
    const latestBtn = document.getElementById('latestBtn');
    const openOnYouTube = document.getElementById('openOnYouTube');

    // Fixed target (September 2025)
    const TARGET_YEAR = 2025;
    const TARGET_MONTH = 8; // 0-indexed (8 = September)

    /* -------------------------
       Helper functions
       ------------------------- */
    function pad(n){ return String(n).padStart(2,'0'); }

    function safeSetHash(iso){
      try {
        if(typeof history.replaceState === 'function') history.replaceState(null,'',`#${iso}`);
        else location.hash = `#${iso}`;
      } catch (err) {
        // ignore
      }
    }

    function showPlaceholder(){
      playerMount.innerHTML = '<div class="placeholder">Select a date to watch the video</div>';
      playerFrame.classList.add('shimmer');
      openOnYouTube.style.display = 'none';
      openOnYouTube.href = '#';
    }

    /* Extract YouTube video ID from common URL forms.
       Returns 11-character ID or null.
    */
    function parseYouTubeID(url){
      if(!url || typeof url !== 'string') return null;
      const s = url.trim();

      // common patterns: youtu.be/ID, youtube.com/watch?v=ID, youtube.com/shorts/ID, youtube.com/embed/ID
      const m = s.match(/(?:youtu\.be\/|youtube(?:-nocookie)?\.com\/(?:watch\?v=|shorts\/|embed\/))([A-Za-z0-9_-]{11})/);
      if(m && m[1]) return m[1];

      // fallback: try URLSearchParams for v=
      try {
        const u = new URL(s, 'https://example.com');
        const v = u.searchParams.get('v');
        if(v && /^[A-Za-z0-9_-]{11}$/.test(v)) return v;
      } catch(e){ /* ignore malformed URL */ }

      // final fallback: last path segment (may catch some valid IDs)
      const seg = s.split('/').filter(Boolean).pop().split('?')[0];
      if(seg && /^[A-Za-z0-9_-]{11}$/.test(seg)) return seg;

      return null;
    }

    /* Build the player inside the square frame.
       Accepts either:
         - a URL string (common case)
         - or an HTML string containing an iframe (less common)
    */
    function makePlayerFromSource(source){
      playerFrame.classList.remove('shimmer');
      playerMount.innerHTML = ''; // clear

      if(!source) {
        showPlaceholder();
        return;
      }

      if(typeof source !== 'string') {
        // not expected, but fallback
        playerMount.innerHTML = '<div class="placeholder">Invalid video source</div>';
        return;
      }

      const trimmed = source.trim();

      // If the user accidentally pasted full iframe or embed HTML, insert it directly.
      if(trimmed.startsWith('<') && trimmed.indexOf('iframe') !== -1){
        // ensure the embedded iframe fills the container
        // wrap in a container and force the iframe to absolute fill
        playerMount.innerHTML = '<div style="position:relative;height:100%;">' + trimmed + '</div>';
        // try to find and adjust iframe attributes
        const iframe = playerMount.querySelector('iframe');
        if(iframe){
          iframe.classList.add('player-iframe');
          iframe.removeAttribute('width');
          iframe.removeAttribute('height');
          iframe.setAttribute('allow','accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share');
          iframe.setAttribute('allowfullscreen','');
        }
        // Set openOnYouTube to point to src (if present)
        const src = (playerMount.querySelector('iframe') || {}).src || null;
        if(src){
          openOnYouTube.href = src;
          openOnYouTube.style.display = 'inline-flex';
        } else {
          openOnYouTube.style.display = 'none';
        }
        return;
      }

      // Otherwise treat as URL
      const id = parseYouTubeID(trimmed);
      if(!id){
        // If we can't parse, show a fallback link
        playerMount.innerHTML = `<div class="placeholder">Can't parse the YouTube URL. <div style="margin-top:10px"><a target="_blank" rel="noopener" href="${escapeHtml(trimmed)}">Open link</a></div></div>`;
        openOnYouTube.href = trimmed;
        openOnYouTube.style.display = 'inline-flex';
        return;
      }

      // Use privacy-enhanced YouTube domain to reduce tracking (you can switch to normal domain if you prefer)
      const embedUrl = `https://www.youtube-nocookie.com/embed/${id}?rel=0&modestbranding=1&playsinline=1`;

      const iframe = document.createElement('iframe');
      iframe.className = 'player-iframe';
      iframe.src = embedUrl;
      iframe.setAttribute('frameborder','0');
      iframe.setAttribute('allow','accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share');
      iframe.setAttribute('allowfullscreen','');
      iframe.title = 'YouTube video player';

      // Provide a small accessible fallback link for users who want to open on YouTube
      openOnYouTube.href = `https://youtube.com/watch?v=${id}`;
      openOnYouTube.style.display = 'inline-flex';

      playerMount.appendChild(iframe);
    }

    // simple escaper for inserting unknown hrefs into markup (used only for fallback link)
    function escapeHtml(s){
      return String(s).replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    /* -------------------------
       Calendar rendering (September-only)
       ------------------------- */
    function buildDOW(){
      const names = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
      dowRow.innerHTML = '';
      names.forEach(n => { const el = document.createElement('div'); el.className='dow'; el.textContent=n; dowRow.appendChild(el);} );
    }

    function buildCalendar(){
      const year = TARGET_YEAR;
      const month = TARGET_MONTH;
      monthLabel.textContent = 'September ' + year;

      const first = new Date(year, month, 1);
      const last = new Date(year, month+1, 0);

      daysGrid.innerHTML = '';

      // Lead blanks so Monday is the first column
      let startDow = first.getDay(); // 0=Sun .. 6=Sat
      if(startDow === 0) startDow = 7; // convert Sunday to 7
      for(let i=1;i<startDow;i++){
        const empty = document.createElement('div');
        empty.className = 'day is-empty';
        daysGrid.appendChild(empty);
      }

      // Create each day of the month
      for(let d=1; d<=last.getDate(); d++){
        const date = new Date(year, month, d);
        const iso = `${date.getFullYear()}-${pad(date.getMonth()+1)}-${pad(d)}`;

        const cell = document.createElement('div');
        cell.className = 'day';
        cell.innerHTML = `<div class="num">${d}</div>`;

        const hasVideo = Boolean(videosByDate[iso]);
        const badge = document.createElement('div');
        badge.className = 'badge ' + (hasVideo ? '' : 'miss');
        badge.textContent = hasVideo ? 'Video' : '—';
        cell.appendChild(badge);

        // keyboard + screen reader friendly
        cell.tabIndex = 0;
        cell.setAttribute('role','button');
        cell.setAttribute('aria-label', `${iso} ${hasVideo ? 'has video' : 'no video yet'}`);

        // click/keyboard handler
        cell.addEventListener('click', () => selectDate(iso));
        cell.addEventListener('keydown', (e) => { if(e.key==='Enter' || e.key===' '){ e.preventDefault(); selectDate(iso); } });

        daysGrid.appendChild(cell);
      }
    }

    /* -------------------------
       Selection logic
       ------------------------- */
    function selectDate(iso){
      selectedDateLabel.textContent = new Date(iso).toDateString();
      const source = videosByDate[iso];
      if(source){
        statusLabel.textContent = 'Loading…';
        try {
          makePlayerFromSource(source);
        } catch(e){
          console.error('Player render failed', e);
          playerMount.innerHTML = '<div class="placeholder">Video failed to load.</div>';
        }
        try { document.getElementById('playerFrame')?.scrollIntoView({behavior:'smooth', block:'start'}); } catch(e){}
        safeSetHash(iso);
      } else {
        statusLabel.textContent = 'No video uploaded yet for this date.';
        showPlaceholder();
      }
    }

    /* -------------------------
       Utility: find latest uploaded date (lexicographical sort works for ISO strings)
       ------------------------- */
    function getLatestDateWithVideo(){
      const keys = Object.keys(videosByDate).sort();
      return keys.length ? keys[keys.length-1] : null;
    }

    // wire up the "latest" button — jumps to the latest uploaded video
    latestBtn.addEventListener('click', ()=>{
      const latest = getLatestDateWithVideo();
      if(latest){ selectDate(latest); }
      else { statusLabel.textContent = 'No videos added yet.'; }
    });

    /* -------------------------
       Initialization
       ------------------------- */
    buildDOW();
    buildCalendar();
    showPlaceholder();

    // Auto-open demo day 1 if present
    const demoIso = `${TARGET_YEAR}-09-01`;
    if(videosByDate[demoIso]){
      // small delay so the calendar renders first
      setTimeout(()=>selectDate(demoIso), 120);
    }

    // If the URL contains a hash for an ISO date, try to open it (guarded)
    try {
      if(location.hash && /^#\d{4}-\d{2}-\d{2}$/.test(location.hash)){
        const iso = location.hash.slice(1);
        const d = new Date(iso);
        if(!isNaN(+d)) selectDate(iso);
      }
    } catch(e){ /* ignore sandbox URL oddities */ }

  </script>

  <!-- Instagram embed script removed — not needed anymore -->
</body>
</html>
